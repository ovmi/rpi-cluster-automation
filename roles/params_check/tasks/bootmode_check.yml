---
- name: Normalize boot_mode parameter
  ansible.builtin.set_fact:
    boot_mode_param: "{{ boot_mode_param | lower }}"

- name: Validate boot_mode_param value
  ansible.builtin.assert:
    that:
      - boot_mode_param in boot_sequences.keys()
    fail_msg: "Invalid boot_mode '{{ boot_mode_param }}'. Valid options are: {{ boot_sequences.keys() | list | join(', ') }}."
    success_msg: "Boot mode parameter '{{ boot_mode_param }}' is valid."

- name: Resolve boot sequence from mode
  ansible.builtin.set_fact:
    boot_seq: "{{ boot_sequences[boot_mode_param] }}"

- name: Build BOOT_ORDER from sequence
  ansible.builtin.set_fact:
    boot_order: "0x{{ boot_seq | map('extract', boot_modes) | join('') }}"

- name: Show BOOT_ORDER setting
  ansible.builtin.debug:
    msg: "Setting BOOT_ORDER to {{ boot_order }} for boot mode {{ boot_mode_param }}"
  when: debug | default(false)
